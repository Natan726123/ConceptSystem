unit uFormDashboard;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Unit2, uFormCadastroTecido, Vcl.Menus,
  VCLTee.TeCanvas, uFormDBPath, uFormCadastroProduto, uFormCortador, Vcl.Styles, Vcl.Themes,
  Vcl.Imaging.pngimage, Vcl.ExtCtrls, uFormCadastroFaccao, uFormFichaFaccao, uFormEstoqueProdutos,
  VclTee.TeeGDIPlus, FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, Data.DB, FireDAC.Comp.DataSet,
  FireDAC.Comp.Client, VCLTee.TeEngine, VCLTee.Series, VCLTee.TeeProcs, uDataModulo,
  VCLTee.Chart, VCLTee.DBChart, VCLTee.TeeDBCrossTab, Math;

type
  TFormDashboard = class(TForm)
    btnGerarOrdemCorte: TButton;
    btnCadastrarCortador: TButton;
    btnCadastrarTecido: TButton;
    btnCadastrarProdutos: TButton;
    btnCadastrarFaccao: TButton;
    btnCriarFichaFaccao: TButton;
    MainMenu1: TMainMenu;
    Cadastrar1: TMenuItem;
    CadastrarProduto1: TMenuItem;
    CadastrarTecido1: TMenuItem;
    CadastrarCortador1: TMenuItem;
    CadastrarFaccionista1: TMenuItem;
    Editar1: TMenuItem;
    Basededados1: TMenuItem;
    Label1: TLabel;
    Image1: TImage;
    Visualizar1: TMenuItem;
    Aparncia1: TMenuItem;
    Dark1: TMenuItem;
    Light1: TMenuItem;
    Blue1: TMenuItem;
    Default1: TMenuItem;
    Default2: TMenuItem;
    Image2: TImage;
    pnlCadastros: TPanel;
    Label2: TLabel;
    pnlOperacoes: TPanel;
    Label3: TLabel;
    btnGerenciarEstoque: TButton;
    ChartRankingCorte: TChart;
    Series1: TBarSeries;
    FDQueryCortadores: TFDQuery;
    DSDadosCortadores: TDataSource;
    DBCrossTabSource1: TDBCrossTabSource;
    DBCrossTabSource2: TDBCrossTabSource;
    procedure btnGerarOrdemCorteClick(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure btnCadastrarTecidoClick(Sender: TObject);
    procedure CadastrarTecido1Click(Sender: TObject);
    procedure Basededados1Click(Sender: TObject);
    procedure btnCadastrarProdutosClick(Sender: TObject);
    procedure CadastrarProduto1Click(Sender: TObject);
    procedure btnCadastrarCortadorClick(Sender: TObject);
    procedure btnStyleGlossyClick(Sender: TObject);
    procedure btnOnyxBlueClick(Sender: TObject);
    procedure Dark1Click(Sender: TObject);
    procedure Light1Click(Sender: TObject);
    procedure Blue1Click(Sender: TObject);
    procedure Default1Click(Sender: TObject);
    procedure Default2Click(Sender: TObject);
    procedure btnCadastrarFaccaoClick(Sender: TObject);
    procedure btnCriarFichaFaccaoClick(Sender: TObject);
    procedure btnGerenciarEstoqueClick(Sender: TObject);
    procedure AjustarMarksNoCentro;
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FormDashboard: TFormDashboard;

implementation

{$R *.dfm}

procedure TFormDashboard.AjustarMarksNoCentro;
var
  i: Integer;
  BarTop, BarBottom, BarHeight, YCenter: Integer;
begin
  for i := 0 to Series1.Count - 1 do
  begin
    // Calcula o centro vertical da barra
    BarTop := Series1.CalcYPos(i); // Posição superior da barra
    BarBottom := Series1.CalcYPosValue(0);  // Posição inferior (base do gráfico)
    BarHeight := Abs(BarBottom - BarTop);   // Altura da barra
    YCenter := BarTop + (BarHeight div 2);  // Centro vertical

    // Ajusta a posição do rótulo
    Series1.Marks.Positions[i].Custom := True;
    Series1.Marks.Positions[i].LeftTop := Point(
      Series1.CalcXPos(i) - (Series1.Marks.Width div 2),
      YCenter - (Series1.Marks.Height div 2)
    );

    // Define o texto do rótulo (corrigido)
    Series1.Marks.Items[i].Text.Clear; // Limpa o texto existente
    Series1.Marks.Items[i].Text.Add(FormatFloat('0.##', Series1.YValue[i]));
  end;
end;



procedure TFormDashboard.btnGerarOrdemCorteClick(Sender: TObject);
var
  formCorte : TFormGerarOrdemCorte;
begin
  formCorte := TFormGerarOrdemCorte.Create(Self);
  try
    if not Assigned(formCorte) then
    Application.CreateForm(TFormGerarOrdemCorte, FormGerarOrdemCorte);

    formCorte.Show;
  finally
    //formCorte.Free;
  end;

end;

procedure TFormDashboard.btnGerenciarEstoqueClick(Sender: TObject);
var
  formEstoqueProdutos: TFormEstoqueProdutos;
begin
  formEstoqueProdutos := TFormEstoqueProdutos.Create(Self);
  try
    formEstoqueProdutos.ShowModal;
  finally
    formEstoqueProdutos.Free;
  end;
end;

procedure TFormDashboard.btnOnyxBlueClick(Sender: TObject);
begin
  TStyleManager.TrySetStyle('Onyx Blue');
end;

procedure TFormDashboard.btnStyleGlossyClick(Sender: TObject);
begin
  TStyleManager.TrySetStyle('Glossy');
end;

procedure TFormDashboard.btnCadastrarFaccaoClick(Sender: TObject);
var
  formCadastrarFaccao: TFormCadastroFaccao;
begin
  formCadastrarFaccao := TFormCadastroFaccao.Create(Self);
  try
    formCadastrarFaccao.ShowModal;
  finally
    formCadastrarFaccao.Free;
  end;
end;

procedure TFormDashboard.Blue1Click(Sender: TObject);
begin
  TStyleManager.TrySetStyle('Onyx Blue');
end;

procedure TFormDashboard.btnCadastrarCortadorClick(Sender: TObject);
begin
  var
  formCadastrarCortador: TFormCadastroCortador;
begin
  formCadastrarCortador := TFormCadastroCortador.Create(Self);
  try
    formCadastrarCortador.ShowModal;
  finally
    formCadastrarCortador.Free;
  end;
end;
end;

procedure TFormDashboard.btnCadastrarProdutosClick(Sender: TObject);
begin
  var
  formCadastrarProduto: TFormCadastrarProdutos;
begin
  formCadastrarProduto := TFormCadastrarProdutos.Create(Self);
  try
    formCadastrarProduto.ShowModal;
  finally
    formCadastrarProduto.Free;
  end;
end;
end;

procedure TFormDashboard.Basededados1Click(Sender: TObject);
var
  formPathDB : TFormPathDB;
begin
  formPathDB := TFormPathDB.Create(Self);
  try
    //if not Assigned(formPathDB) then
    //Application.CreateForm(TFormPathDB, formPathDB);
    formPathDB.ShowModal;
  finally

  end;
end;

procedure TFormDashboard.btnCadastrarTecidoClick(Sender: TObject);
var
  formCadastrarTecido: TFormCadastroTecido;
begin
  formCadastrarTecido := TFormCadastroTecido.Create(Self);
  try
    formCadastrarTecido.ShowModal; // Exibe o formulário como modal, mantendo-o aberto até ser fechado
  finally
    formCadastrarTecido.Free; // Libera o formulário da memória somente após ele ser fechado
  end;
end;

procedure TFormDashboard.btnCriarFichaFaccaoClick(Sender: TObject);
var
  formFichaFaccao: TFormFichaFaccao;
begin
  formFichaFaccao := TFormFichaFaccao.Create(Self);
  try
    formFichaFaccao.ShowModal; // Exibe o formulário como modal, mantendo-o aberto até ser fechado
  finally
    formFichaFaccao.Free; // Libera o formulário da memória somente após ele ser fechado
  end;
end;

procedure TFormDashboard.CadastrarProduto1Click(Sender: TObject);
var
  formCadastrarProduto: TFormCadastrarProdutos;
begin
  formCadastrarProduto := TFormCadastrarProdutos.Create(Self);
  try
    formCadastrarProduto.ShowModal; // Exibe o formulário como modal, mantendo-o aberto até ser fechado
  finally
    formCadastrarProduto.Free; // Libera o formulário da memória somente após ele ser fechado
  end;
end;

procedure TFormDashboard.CadastrarTecido1Click(Sender: TObject);
var
  formCadastrarTecido: TFormCadastroTecido;
begin
  formCadastrarTecido := TFormCadastroTecido.Create(Self);
  try
    formCadastrarTecido.ShowModal; // Exibe o formulário como modal, mantendo-o aberto até ser fechado
  finally
    formCadastrarTecido.Free; // Libera o formulário da memória somente após ele ser fechado
  end;
end;


procedure TFormDashboard.Dark1Click(Sender: TObject);
begin
  TStyleManager.TrySetStyle('Glossy');
end;

procedure TFormDashboard.Default1Click(Sender: TObject);
begin
  TStyleManager.TrySetStyle('Glow');
end;

procedure TFormDashboard.Default2Click(Sender: TObject);
begin
  TStyleManager.TrySetStyle('Windows');
end;

procedure TFormDashboard.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  Action := caHide;
end;

procedure TFormDashboard.FormShow(Sender: TObject);
begin
   //Series1.FillSampleValues(10);
  AjustarMarksNoCentro;
end;

procedure TFormDashboard.Light1Click(Sender: TObject);
begin
  TStyleManager.TrySetStyle('Light');
end;

end.
